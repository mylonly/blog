<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  Linux - 独自一人
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="独自一人" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:blog.xgtian.com ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="self" href="index.html">Home</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="https://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; 独自一人</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
        
        <li><a target="self" href="index.html">Home</a></li>
        
        <li><a target="_self" href="archives.html">Archives</a></li>
        

    <li><label>Categories</label></li>

        
            <li><a href="ios.html">iOS</a></li>
        
            <li><a href="linux.html">Linux</a></li>
        
            <li><a href="python.html">Python</a></li>
        
            <li><a href="tools.html">Tools</a></li>
        
            <li><a href="django-learn.html">Django学习</a></li>
        
            <li><a href="Weex.html">Weex</a></li>
        
            <li><a href="Tensorflow.html">Tensorflow</a></li>
        
            <li><a href="%E8%BF%9C%E5%8F%A4%E7%9F%A5%E8%AF%86.html">远古知识</a></li>
        
            <li><a href="Kali%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.html">Kali渗透测试</a></li>
        
            <li><a href="docker.html">Docker</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
	$(function(){
		$('#menu_item_index').addClass('is_active');
	});
</script>
<div class="row">
	<div class="large-8 medium-8 columns">
		<div class="markdown-body home-categories">
		
			<div class="article">
                <a class="clearlink" href="15595559159421.html">
                
                  <h1>Linux 测试磁盘性能</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>测试场景：</p>

<p>100%随机，100%读， 4K</p>

<pre><code class="language-text">fio -filename=/dev/emcpowerb -direct=1 -iodepth 1 -thread -rw=randread -ioengine=psync -bs=4k -size=1000G -numjobs=50 -runtime=180 -group_reporting -name=rand_100read_4k
</code></pre>

<p>100%随机，100%写， 4K</p>

<pre><code class="language-text">fio -filename=/dev/emcpowerb -direct=1 -iodepth 1 -thread -rw=randwrite -ioengine=psync -bs=4k -size=1000G -numjobs=50 -runtime=180 -group_reporting -name=rand_100write_4k
</code></pre>

<p>100%顺序，100%读 ，4K</p>

<pre><code class="language-text">fio -filename=/dev/emcpowerb -direct=1 -iodepth 1 -thread -rw=read -ioengine=psync -bs=4k -size=1000G -numjobs=50 -runtime=180 -group_reporting -name=sqe_100read_4k
</code></pre>

<p>100%顺序，100%写 ，4K</p>

<pre><code class="language-text">fio -filename=/dev/emcpowerb -direct=1 -iodepth 1 -thread -rw=write -ioengine=psync -bs=4k -size=1000G -numjobs=50 -runtime=180 -group_reporting -name=sqe_100write_4k
</code></pre>

<p>100%随机，70%读，30%写 4K</p>

<pre><code class="language-text">fio -filename=/dev/emcpowerb -direct=1 -iodepth 1 -thread -rw=randrw -rwmixread=70 -ioengine=psync -bs=4k -size=1000G -numjobs=50 -runtime=180 -group_reporting -name=randrw_70read_4k
</code></pre>

<p>io=执行了多少M的IO</p>

<p>bw=平均IO带宽<br/>
iops=IOPS<br/>
runt=线程运行时间<br/>
slat=提交延迟<br/>
clat=完成延迟<br/>
lat=响应时间<br/>
bw=带宽<br/>
cpu=利用率<br/>
IO depths=io队列<br/>
IO submit=单个IO提交要提交的IO数<br/>
IO complete=Like the above submit number, but for completions instead.<br/>
IO issued=The number of read/write requests issued, and how many of them were short.<br/>
IO latencies=IO完延迟的分布</p>

<p>io=总共执行了多少size的IO<br/>
aggrb=group总带宽<br/>
minb=最小.平均带宽.<br/>
maxb=最大平均带宽.<br/>
mint=group中线程的最短运行时间.<br/>
maxt=group中线程的最长运行时间.</p>

<p>ios=所有group总共执行的IO数.<br/>
merge=总共发生的IO合并数.<br/>
ticks=Number of ticks we kept the disk busy.<br/>
io_queue=花费在队列上的总共时间.<br/>
util=磁盘利用率</p>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2019/06/03</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='linux.html'>Linux</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15480624203516.html">
                
                  <h1>Ubuntu安装开发者工具包(make,g++,cc之类工具)</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<pre><code class="language-text">sudo apt-get install build-essential
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2019/01/21</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='linux.html'>Linux</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15477022109795.html">
                
                  <h1>别人的vim配置文件</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<ol>
<li><p>下载vundle插件</p>
<pre><code class="language-text">git clonehttps://github.com/gmarik/vundle.git ~/.vim/bundle/vundle
</code></pre></li>
<li><p>拷贝至~/.vimrc</p>
<pre><code class="language-text">
&quot;========================================  <br/>
&quot; File Name: .vimrc  <br/>
&quot; Author: Ricky.K <br/>
&quot; Description: Vim配置文档  <br/>
&quot; Date: 2014.7.12  <br/>
&quot;========================================  <br/>
let mapleader = &#39;,&#39;  <br/>
let g:mapleader = &#39;,&#39;  <br/>
&quot;==========================================<br/>
&quot; General Settings<br/>
&quot;==========================================<br/>
&quot; 开启语法高亮  <br/>
syntax enable  <br/>
&quot; 开启语法高亮<br/>
syntax on  <br/>
&quot; 设置字体  <br/>
set guifont=Monaco\ 12<br/>
&quot; 设置历史记录条数  <br/>
set history=2000  <br/>
&quot; 检测文件类型  <br/>
filetype on  <br/>
&quot; 针对不同的文件，采用不同的缩进方式  <br/>
filetype indent on  <br/>
&quot; 允许插件  <br/>
filetype plugin on  <br/>
&quot; 启动自动补全<br/>
filetype plugin indent on<br/>
&quot; 文件修改之后自动读入<br/>
set autoread<br/>
&quot; 启动后不显示提示<br/>
&quot;set shortmess=atI<br/>
&quot; 备份,到另一个位置. 防止误删, 目前是取消备份<br/>
&quot;set backup<br/>
&quot;set backupext=.bak<br/>
&quot;set backupdir=/tmp/vimbk/<br/>
&quot; 设置取消备份，禁止临时文件生成  <br/>
set nobackup  <br/>
set noswapfile  <br/>
&quot; create undo file<br/>
set undolevels=1000 &quot; how many undos<br/>
set undoreload=10000 &quot; number of lines to save for undo<br/>
if v:version &gt;= 730<br/>
    set undofile     &quot; keep a persistent backup file<br/>
    set undodir=/tmp/vimundo/<br/>
endif<br/>
&quot;set wildignore=*.swp,*.bak,*.pyc,*.class,.svn<br/>
&quot; 显示当前横竖线  <br/>
&quot;set cursorline  <br/>
&quot;set cursorcolumn  <br/>
&quot; 设置退出Vim之后内容显示在终端屏幕，可以用于查看和复制<br/>
&quot; 好处:误删什么，如果以前屏幕打开可以用来找回<br/>
&quot; set t_ti= t_te=<br/>
&quot; 设置在Vim中可以使用鼠标，防止终端无法拷贝  <br/>
set mouse=a  <br/>
&quot; 修复ctrl+m多光标操作选择的bug,但是改变了ctrl+v进行字符选中将包含光标下的字符<br/>
&quot; set selection=inclusive<br/>
&quot; set selectmode=mouse,key<br/>
&quot; no errors sound<br/>
set title &quot; change ther terminal&#39;s title<br/>
set novisualbell &quot; don&#39;t beep<br/>
set noerrorbells &quot; don&#39;t beep<br/>
set t_vb=<br/>
set tm=500<br/>
&quot; remember info about open buffers on close<br/>
set viminfo^=%<br/>
&quot; for regular expression turn magic on<br/>
set magic<br/>
&quot; configure backspace so it acts as it should act<br/>
set backspace=eol,start,indent<br/>
set whichwrap+=&lt;,&gt;,h,l<br/>
&quot; FuzzyFinder and ctrlp couldn&#39;t auto change dir you must manual add cd in<br/>
&quot; command mode, so add this command to auto change current dir for these<br/>
&quot; plugins<br/>
&quot; set autochdir<br/>
&quot;==========================================<br/>
&quot; Display Settings<br/>
&quot;==========================================<br/>
&quot;<br/>
&quot; 显示当前行号和列号<br/>
set ruler<br/>
&quot; 在状态栏显示正在输入的命令<br/>
set showcmd<br/>
&quot; 左下角显示当前Vim模式<br/>
set showmode<br/>
&quot; 光标移动至少保留的行数<br/>
&quot;set scrolloff=7<br/>
&quot; 命令行（在状态行下）的高度，默认为1，这里是2<br/>
set statusline=%&lt;%f\ %h%m%r%=%k[%{(&amp;fenc==\&quot;\&quot;)?&amp;enc:&amp;fenc}%{(&amp;bomb?\&quot;,BOM\&quot;:\&quot;\&quot;)}]\ %-14.(%l,%c%V%)\ %P<br/>
&quot; 总是显示状态栏(Powerline需要2行)  <br/>
set laststatus=2  <br/>
&quot; 显示行号  <br/>
set number  <br/>
&quot; 指定不折行<br/>
set nowrap  <br/>
&quot; 设置代码匹配,包括括号匹配情况  <br/>
set showmatch  <br/>
&quot; how many tenths of a second to blink when matching brackets<br/>
&quot; setmatchtime=2<br/>
&quot; 开启及时搜索(is)  <br/>
set incsearch  <br/>
&quot; 设置搜索高亮(hlsearch)  <br/>
set hls  <br/>
&quot; 设置搜索时忽略大小写  <br/>
set ignorecase  <br/>
&quot; 当搜索的时候尝试smart  <br/>
set smartcase  <br/>
&quot; 设置代码折叠<br/>
&quot;set foldenable<br/>
&quot; 折叠方法<br/>
&quot; manual 手工折叠<br/>
&quot; indent 缩进折叠<br/>
&quot; expr 表达式折叠<br/>
&quot; syntax 语法折叠<br/>
&quot; diff 对没有更改的文件折叠<br/>
&quot; marker 标记折叠<br/>
&quot;set foldmethod=indent<br/>
&quot;set foldlevel=99<br/>
&quot; 设置C/C++方式自动对齐  <br/>
set autoindent  <br/>
set cindent  <br/>
set smartindent  <br/>
&quot; 设置tab宽度  <br/>
set tabstop=4  <br/>
&quot; 设置自动对齐空格数  <br/>
set shiftwidth=4  <br/>
&quot; 按退格键时可以一次删除4个空格<br/>
&quot;set softtabstop=4<br/>
 &quot; 编辑的时候将所有的tab设置为空格(expandtab)  <br/>
 set et  <br/>
 &quot; 使用Backspace直接删除tab  <br/>
 set smarttab  <br/>
&quot; 不在单词中间折行  <br/>
set lbr  <br/>
 &quot; 缩进时取整use multiple of shiftwidth when indenting with &#39;&lt;&#39; and &#39;&gt;&#39;<br/>
 &quot; set shiftround<br/>
 &quot; a buffer becomes hidden when it is abandoned<br/>
 &quot; set hidden<br/>
 &quot; set wildmode=list:longest<br/>
 &quot; set ttyfast<br/>
 &quot; 00x增减数字时使用十进制<br/>
 &quot;set nrformats=<br/>
 &quot;<br/>
 &quot;==========================================<br/>
 &quot; FileEncode Settings<br/>
 &quot;==========================================<br/>
 &quot; 设置编码方式  <br/>
 set encoding=utf-8  <br/>
 &quot; 设置打开文件的编码格式  <br/>
 set fileencodings=ucs-bom,utf-8,cp936,gb18030,big5,euc-jp,euc-kr,latin1  <br/>
 set helplang=cn <br/>
 &quot; 只对终端影响(默认)<br/>
 set termencoding=utf-8<br/>
 &quot; use UNIX as the standard file type<br/>
 set ffs=unix,dos,mac<br/>
&quot; 如遇Unicode值大于255的文本，不必等到空格再折行。<br/>
set formatoptions+=m<br/>
&quot; 合并两行中文时，不在中间加空格：<br/>
set formatoptions+=B<br/>
&quot;==========================================<br/>
&quot; Other Settings<br/>
&quot;==========================================<br/>
 &quot;autocmd! bufwritepost _vimrc source %    &quot; .vimrc修改之后自动加载(Windows)<br/>
 &quot;autocmd! bufwritepost .vimrc source %    &quot; .vimrc修改之后自动加载(Linux)<br/>
 &quot; 自动补全配置让Vim补全菜单行为跟IDE一致<br/>
 set completeopt=longest,menu<br/>
 &quot; 增强模式中的命令行自动完成操作<br/>
 set wildmenu<br/>
 &quot; ignore compiled files<br/>
 &quot; set wildignore=*.o,*~,*.pyc,*.class<br/>
&quot;离开插入模式后自动关闭预览窗口<br/>
autocmd InsertLeave * if pumvisible() == 0|pclose|endif<br/>
&quot;回车即选中当前项<br/>
inoremap &lt;expr&gt; &lt;CR&gt;       pumvisible() ? &quot;\&lt;C-y&gt;&quot; : &quot;\&lt;CR&gt;&quot;<br/>
&quot;上下左右键的行为 会显示其他信息<br/>
inoremap &lt;expr&gt; &lt;Down&gt;     pumvisible() ? &quot;\&lt;C-n&gt;&quot; : &quot;\&lt;Down&gt;&quot;<br/>
inoremap &lt;expr&gt; &lt;Up&gt;       pumvisible() ? &quot;\&lt;C-p&gt;&quot; : &quot;\&lt;Up&gt;&quot;<br/>
inoremap &lt;expr&gt; &lt;PageDown&gt; pumvisible() ? &quot;\&lt;PageDown&gt;\&lt;C-p&gt;\&lt;C-n&gt;&quot; : &quot;\&lt;PageDown&gt;&quot;<br/>
inoremap &lt;expr&gt; &lt;PageUp&gt;   pumvisible() ? &quot;\&lt;PageUp&gt;\&lt;C-p&gt;\&lt;C-n&gt;&quot; : &quot;\&lt;PageUp&gt;&quot;<br/>
&quot; if this not work ,make sure .viminfo is writable for you<br/>
if has(&quot;autocmd&quot;)<br/>
  au BufReadPost * if line(&quot;&#39;\&quot;&quot;) &gt; 1 &amp;&amp; line(&quot;&#39;\&quot;&quot;) &lt;= line(&quot;$&quot;) | exe &quot;normal! g&#39;\&quot;&quot; | endif<br/>
endif<br/>
&quot;==========================================<br/>
&quot; HotKey Settings<br/>
&quot;==========================================<br/>
&quot;<br/>
&quot; 去掉搜索高亮<br/>
&quot;noremap &lt;silent&gt;&lt;leader&gt;/ :nohls&lt;CR&gt;<br/>
map &lt;leader&gt;/ :nohls&lt;CR&gt;<br/>
map &lt;leader&gt;tn :tabnew&lt;cr&gt;<br/>
map &lt;leader&gt;to :tabonly&lt;cr&gt;<br/>
map &lt;leader&gt;tc :tabclose&lt;cr&gt;<br/>
map &lt;leader&gt;tm :tabmove<br/>
&quot; Opens a new tab with the current buffer&#39;s path<br/>
&quot; Super useful when editing files in the same directory<br/>
map &lt;leader&gt;te :tabedit &lt;c-r&gt;=expand(&quot;%:p:h&quot;)&lt;cr&gt;/<br/>
&quot; Quickly edit/reload the vimrc file<br/>
nmap &lt;silent&gt; &lt;leader&gt;ev :e $MYVIMRC&lt;CR&gt;<br/>
nmap &lt;silent&gt; &lt;leader&gt;sv :so $MYVIMRC&lt;CR&gt;<br/>
&quot; 手动刷新tags(含cscope)<br/>
nmap tg :!ctags -R --c++-kinds=+p --fields=+iaS --extra=+q *&lt;CR&gt;:set tags+=./tags&lt;CR&gt;:!cscope -Rbq&lt;CR&gt;:cs add ./cscope.out .&lt;CR&gt;<br/>
&quot; 切换buffer<br/>
nnoremap [b :bp&lt;CR&gt;<br/>
nnoremap ]b :bn&lt;CR&gt;<br/>
&quot; cscope设置<br/>
if has(&quot;cscope&quot;)<br/>
    set csprg=/usr/bin/cscope   &quot; 制定cscope命令<br/>
    set csto=0                  &quot; ctags查找顺序，0表示先cscope数据库再标签文件，1表示先标签文件爱<br/>
    set cst                     &quot; 同时搜索tag文件和cscope数据库<br/>
    set cscopequickfix=s-,c-,d-,i-,t-,e-  &quot;使用QucikFix窗口来显示cscope查找结果<br/>
    set nocsverb<br/>
    if filereadable(&quot;cscope.out&quot;)  &quot;如果当前目录下有cscope.out则加载进Vim<br/>
        cs add cscope.out<br/>
    elseif $CSCOPE_DB != &quot;&quot;       &quot;否则只要环境变量不为空就添加制定的数据库到Vim<br/>
        cs add $CSCOPE_DB<br/>
    endif<br/>
    set csverb<br/>
endif<br/>
&quot;map &lt;F4&gt;:!cscope -Rbq&lt;CR&gt;:cs add ./cscope.out .&lt;CR&gt;&lt;CR&gt;&lt;CR&gt; :cs reset&lt;CR&gt;<br/>
&quot; 查找符号<br/>
nmap &lt;leader&gt;css :cs find s &lt;C-R&gt;=expand(&quot;&lt;cword&gt;&quot;)&lt;CR&gt;&lt;CR&gt; :copen&lt;CR&gt;&lt;CR&gt;<br/>
&quot; 查找定义<br/>
nmap &lt;leader&gt;csg :cs find g &lt;C-R&gt;=expand(&quot;&lt;cword&gt;&quot;)&lt;CR&gt;&lt;CR&gt;<br/>
&quot; 查找被这个函数调用的函数<br/>
nmap &lt;leader&gt;csd :cs find d &lt;C-R&gt;=expand(&quot;&lt;cword&gt;&quot;)&lt;CR&gt;&lt;CR&gt; :copen&lt;CR&gt;&lt;CR&gt;<br/>
&quot; 查找调用这个函数的函数<br/>
nmap &lt;leader&gt;csc :cs find c &lt;C-R&gt;=expand(&quot;&lt;cword&gt;&quot;)&lt;CR&gt;&lt;CR&gt;:copen&lt;CR&gt;&lt;CR&gt;<br/>
&quot; 查找这个字符串<br/>
nmap &lt;leader&gt;cst :cs find t &lt;C-R&gt;=expand(&quot;&lt;cword&gt;&quot;)&lt;CR&gt;&lt;CR&gt;:copen&lt;CR&gt;&lt;CR&gt;<br/>
&quot; 查找这个egrep匹配模式<br/>
nmap &lt;leader&gt;cse :cs find e &lt;C-R&gt;=expand(&quot;&lt;cword&gt;&quot;)&lt;CR&gt;&lt;CR&gt;:copen&lt;CR&gt;&lt;CR&gt;<br/>
&quot; 查找这个文件<br/>
nmap &lt;leader&gt;csf :cs find f &lt;C-R&gt;=expand(&quot;&lt;cfile&gt;&quot;)&lt;CR&gt;&lt;CR&gt;<br/>
&quot; 查找include这个文件的文件<br/>
nmap &lt;leader&gt;csi :cs find i &lt;C-R&gt;=expand(&quot;&lt;cfile&gt;&quot;)&lt;CR&gt;&lt;CR&gt; :copen&lt;CR&gt;&lt;CR&gt;<br/>
&quot; 设定是否使用QuickFix来显示结果<br/>
set cscopequickfix=s-,c-,d-,i-,t-,e-<br/>
&quot; QuickFix open and close<br/>
nnoremap &lt;F11&gt; :copen&lt;CR&gt;<br/>
nnoremap &lt;F12&gt; :cclose&lt;CR&gt;<br/>
&quot; QucikFix next and prev<br/>
nnoremap &lt;F9&gt; :cn&lt;CR&gt;<br/>
nnoremap &lt;F10&gt; :cp&lt;CR&gt;<br/>
&quot;==========================================<br/>
&quot; Theme Settings<br/>
&quot;==========================================<br/>
&quot; Set extra options when running in GUI mode<br/>
&quot;if has(&quot;gui_running&quot;)<br/>
&quot;    set guifont=Monaco\ 12<br/>
&quot;    set guioptions-=T<br/>
&quot;    set guioptions+=e<br/>
&quot;    set guioptions-=r<br/>
&quot;    set guioptions-=L<br/>
&quot;    set guitablabel=%M\ %t<br/>
&quot;    set showtabline=1 <br/>
&quot;    set linespace=2 <br/>
&quot;    set noimd   <br/>
&quot;    set t_Co=256<br/>
&quot;endif<br/>
&quot; 设置主题  <br/>
set background=dark<br/>
colorscheme molokai  <br/>
&quot;colorscheme solarized<br/>
set t_Co=256<br/>
&quot; 添加水平滚动条  <br/>
&quot;set guioptions+=b  <br/>
&quot; 取消菜单栏和导航栏  <br/>
set guioptions-=m  <br/>
set guioptions-=T  <br/>
&quot; 去除左右两边滚动条<br/>
set go-=r<br/>
set go-=L<br/>
&quot; 设置水平行数和竖直列数  <br/>
set lines=35  <br/>
set columns=99  <br/>
&quot; 使pathogen生效(插件管理器,只需将插件放入bundle，将pathogen.vim放入autoload即可)  <br/>
&quot;execute pathogen#infect()  <br/>
&quot;<br/>
&quot;==========================================<br/>
&quot; Vundle Settings<br/>
&quot;==========================================<br/>
 &quot; 关闭vi的一致性模式，避免以前版本的一些Bug和局限  <br/>
set nocompatible  <br/>
filetype off &quot; Vundle必须要求使用filetype off，如果不设置该选项，UltiSnips无法使用  <br/>
if has(&#39;win32&#39;) || has(&#39;win64&#39;)<br/>
    set rtp+=$HOME/vimfiles/vundle<br/>
    call vundle#rc(&#39;$HOME/vimfiles/bundle/&#39;)<br/>
else<br/>
   set rtp+=~/.vim/bundle/vundle  <br/>
   call vundle#rc()  <br/>
endi<br/>
&quot; let Vundle manage Vundle   <br/>
&quot; required  <br/>
Bundle &#39;gmarik/vundle&#39;  <br/>
&quot; My bundles here:  <br/>
&quot; original repos on GitHub  <br/>
Bundle &#39;tpope/vim-fugitive&#39;  <br/>
Bundle &#39;Lokaltog/vim-easymotion&#39;  <br/>
&quot; 自动补全单引号，双引号等<br/>
Bundle &#39;Raimondi/delimitMate&#39;<br/>
&quot; 快速加入修改环绕字符<br/>
Bundle &#39;tpope/vim-surround&#39;<br/>
&quot; for repeat -&gt; enhance surround.vim, . to repeat command<br/>
Bundle &#39;tpope/vim-repeat&#39;<br/>
&quot; 多光标编辑 (该插件的ctrl-p可以正常使用，当到达最后一个的时候ctrlp才会起作用)<br/>
Bundle &#39;terryma/vim-multiple-cursors&#39;<br/>
&quot; 对括号等进行光标的控制辅助  <br/>
&quot;Bundle &#39;rstacruz/sparkup&#39;, {&#39;rtp&#39;: &#39;vim/&#39;}  <br/>
&quot;Bundle &#39;tpope/vim-rails.git&#39;  <br/>
Bundle &#39;Valloric/ListToggle&#39;  <br/>
Bundle &#39;L9&#39;  <br/>
&quot; vim-scripts repos  <br/>
Bundle &#39;a.vim&#39;  <br/>
Bundle &#39;grep.vim&#39;<br/>
&quot;Bundle &#39;easytags.vim&#39;  <br/>
&quot;Bundle &#39;c.vim&#39;  <br/>
&quot; non-GitHub repos  <br/>
&quot;Bundle &#39;git://git.wincent.com/command-t.git&#39;  <br/>
&quot; Git repos on your local machine (i.e. when working on your own plugin)  <br/>
&quot;Bundle &#39;file:///Users/gmarik/path/to/plugin&#39;  <br/>
&quot;==========================================<br/>
&quot; ctrlp settings  <br/>
&quot;==========================================<br/>
Bundle &#39;kien/ctrlp.vim&#39;  <br/>
&quot;let g:ctrlp_map = &#39;&lt;leader&gt;p&#39;<br/>
&quot;let g:ctrlp_cmd = &#39;CtrlP&#39;<br/>
&quot;map &lt;leader&gt;f :CtrlPMRU&lt;CR&gt;<br/>
&quot;set wildignore+=*/tmp/*,*.so,*.swp,*.zip     &quot; MacOSX/Linux<br/>
&quot;let g:ctrlp_custom_ignore = {<br/>
&quot;    \ &#39;dir&#39;:  &#39;\v[\/]\.(git|hg|svn|rvm)$&#39;,<br/>
&quot;    \ &#39;file&#39;: &#39;\v\.(exe|so|dll|zip|tar|tar.gz)$&#39;,<br/>
&quot;    \ &#39;link&#39;: &#39;SOME_BAD_SYMBOLIC_LINKS&#39;,<br/>
&quot;    \ }<br/>
let g:ctrlp_custom_ignore = {<br/>
   \ &#39;file&#39;: &#39;\v\.(exe|so|dll|zip|tar|tar.gz|lib|out|png|img|bak|db|o)&#39;<br/>
    \ }<br/>
&quot; 在每次进行切换分支或者重新设定custome_ignore选项的时候,必须手动清除CtrlP的缓存,<br/>
&quot; 也可以使用下句不让它进行缓存处理，但扫描时间会比较耗时<br/>
&quot;let g:ctrlp_use_caching = 0<br/>
let g:ctrlp_working_path_mode=0<br/>
let g:ctrlp_match_window_bottom=1<br/>
let g:ctrlp_max_height=15<br/>
let g:ctrlp_match_window_reversed=0<br/>
let g:ctrlp_mruf_max=500<br/>
let g:ctrlp_follow_symlinks=1<br/>
nnoremap &lt;leader&gt;b :CtrlPBuffer&lt;CR&gt;<br/>
nnoremap &lt;leader&gt;d :CtrlPDir&lt;CR&gt;<br/>
&quot;==============================================================<br/>
&quot; ctrlp-funky settings  ctrlp插件 - 不用ctag进行函数快速跳转<br/>
&quot;==============================================================<br/>
Bundle &#39;tacahiroy/ctrlp-funky&#39;<br/>
&quot;nnoremap &lt;Leader&gt;fu :CtrlPFunky&lt;Cr&gt;<br/>
nnoremap &lt;Leader&gt;f :CtrlPFunky&lt;Cr&gt;<br/>
&quot; narrow the list down with a word under cursor<br/>
&quot;nnoremap &lt;Leader&gt;fU :execute &#39;CtrlPFunky &#39; . expand(&#39;&lt;cword&gt;&#39;)&lt;Cr&gt;<br/>
let g:ctrlp_funky_syntax_highlight = 1<br/>
let g:ctrlp_extensions = [&#39;funky&#39;]<br/>
&quot;==========================================<br/>
&quot; nerdcommenter settings  快速注释<br/>
&quot;==========================================<br/>
Bundle &#39;scrooloose/nerdcommenter&#39;<br/>
&quot; 注释与代码之间留存的空格数<br/>
let g:NERDSpaceDelims = 1<br/>
&quot;==========================================<br/>
&quot; Airline settings<br/>
&quot;==========================================<br/>
&quot;Bundle &#39;bling/vim-airline&#39;<br/>
&quot;Bundle &#39;bling/vim-bufferline&#39;<br/>
&quot;if !exists(&#39;g:airline_symbols&#39;)<br/>
&quot;let g:airline_symbols = {}<br/>
&quot;endif<br/>
&quot;let g:airline_left_sep = &#39;▶&#39;<br/>
&quot;let g:airline_left_alt_sep = &#39;❯&#39;<br/>
&quot;let g:airline_right_sep = &#39;◀&#39;<br/>
&quot;let g:airline_right_alt_sep = &#39;❮&#39;<br/>
&quot;let g:airline_symbols.linenr = &#39;¶&#39;<br/>
&quot;let g:airline_symbols.branch = &#39;⎇&#39;<br/>
&quot;&quot; 开启tabline<br/>
&quot;let g:airline#extensions#tabline#enabled = 1<br/>
&quot;&quot; tabline中当前buffer两端的分隔符<br/>
&quot;let g:airline#extensions#tabline#left_sep = &#39; &#39;<br/>
&quot;&quot; tabline为激活的buffer的两端字符<br/>
&quot;let g:airline#extensions#tabline#left_alt_sep = &#39;|&#39;<br/>
&quot;&quot; tabline中buffer显示编号<br/>
&quot;let g:airline#extensions#tabline#buffer_nr_show = 1<br/>
&quot;let g:airline#extensions#buffline#enabled = 1<br/>
&quot;let g:airline#extensions#bufferline#overwrite_variables = 1<br/>
&quot;&quot; airline主题<br/>
&quot;let g:airline_theme = &#39;powerlineish&#39; <br/>
&quot;括号显示增强<br/>
&quot;Bundle &#39;kien/rainbow_parentheses.vim&#39;<br/>
&quot;let g:rbpt_colorpairs = [<br/>
&quot;    \ [&#39;brown&#39;,       &#39;RoyalBlue3&#39;],<br/>
&quot;    \ [&#39;Darkblue&#39;,    &#39;SeaGreen3&#39;],<br/>
&quot;    \ [&#39;darkgray&#39;,    &#39;DarkOrchid3&#39;],<br/>
&quot;    \ [&#39;darkgreen&#39;,   &#39;firebrick3&#39;],<br/>
&quot;    \ [&#39;darkcyan&#39;,    &#39;RoyalBlue3&#39;],<br/>
&quot;    \ [&#39;darkred&#39;,     &#39;SeaGreen3&#39;],<br/>
&quot;    \ [&#39;darkmagenta&#39;, &#39;DarkOrchid3&#39;],<br/>
&quot;    \ [&#39;brown&#39;,       &#39;firebrick3&#39;],<br/>
&quot;    \ [&#39;gray&#39;,        &#39;RoyalBlue3&#39;],<br/>
&quot;    \ [&#39;black&#39;,       &#39;SeaGreen3&#39;],<br/>
&quot;    \ [&#39;darkmagenta&#39;, &#39;DarkOrchid3&#39;],<br/>
&quot;    \ [&#39;Darkblue&#39;,    &#39;firebrick3&#39;],<br/>
&quot;    \ [&#39;darkgreen&#39;,   &#39;RoyalBlue3&#39;],<br/>
&quot;    \ [&#39;darkcyan&#39;,    &#39;SeaGreen3&#39;],<br/>
&quot;    \ [&#39;darkred&#39;,     &#39;DarkOrchid3&#39;],<br/>
&quot;    \ [&#39;red&#39;,         &#39;firebrick3&#39;],<br/>
&quot;    \ ]<br/>
&quot;let g:rbpt_max = 40<br/>
&quot;let g:rbpt_loadcmd_toggle = 0<br/>
&quot;au VimEnter * RainbowParenthesesToggle<br/>
&quot;au Syntax * RainbowParenthesesLoadRound<br/>
&quot;au Syntax * RainbowParenthesesLoadSquare<br/>
&quot;au Syntax * RainbowParenthesesLoadBraces<br/>
&quot; 主题 solarized <br/>
Bundle &#39;altercation/vim-colors-solarized&#39;<br/>
&quot;let g:solarized_termcolors=256<br/>
let g:solarized_termtrans=1<br/>
let g:solarized_contrast=&quot;normal&quot;<br/>
let g:solarized_visibility=&quot;normal&quot;<br/>
&quot; 主题 molokai <br/>
Bundle &#39;tomasr/molokai&#39;<br/>
&quot;==========================================<br/>
&quot; TagList settings<br/>
&quot;==========================================<br/>
Bundle &#39;taglist.vim&#39;  <br/>
&quot; increase the width of the taglist window  <br/>
&quot;let Tlist_WinWidth=20  <br/>
&quot; 自动打开TagList的window  <br/>
let Tlist_Auto_Open=0  <br/>
&quot; 当只剩下Tlist的时候自动关闭  <br/>
let Tlist_Exit_OnlyWindow=1  <br/>
&quot; 打开tags用单击  <br/>
let Tlist_Use_SingleClick=1  <br/>
&quot; close tag folders for inactive buffers  <br/>
let Tlist_File_Fold_Auto_Close=1  <br/>
&quot; show the fold indiactor column in the taglist window  <br/>
let Tlist_Enable_Fold_Column=1  <br/>
&quot; 自动更新TagList包含最新编辑的文件  <br/>
let Tlist_Auto_Update=1  <br/>
&quot; 显示一个文件的tag  <br/>
let Tlist_Show_One_File=1  <br/>
&quot; 在右侧显示窗口  <br/>
let Tlist_Use_Right_Window=1  <br/>
&quot; 按照名称排序  <br/>
let Tlist_Sort_Type=&quot;name&quot;  <br/>
&quot; 让TagList始终解释文件中的tag,不管TagList窗口有没有打开  <br/>
let Tlist_Process_File_Always=1  <br/>
&quot; 设置leader键  <br/>
nnoremap &lt;leader&gt;tl :TlistToggle&lt;CR&gt;  <br/>
&quot;==========================================<br/>
&quot; YouCompleteMe settings<br/>
&quot;==========================================<br/>
Bundle &#39;Valloric/YouCompleteMe&#39;  <br/>
&quot;let g:ycm_key_list_select_completion=[&#39;&lt;c-n&gt;&#39;]<br/>
&quot;let g:ycm_key_list_previous_completion=[&#39;&lt;c-p&gt;&#39;]<br/>
let g:ycm_global_ycm_extra_conf=&#39;~/.vim/bundle/YouCompleteMe/third_party/ycmd/examples/.ycm_extra_conf.py&#39;  <br/>
let g:ycm_collect_indentifiers_from_tags_files=1  <br/>
let g:ycm_seed_identifiers_with_syntax=1  <br/>
&quot; 避免YCM每次加载都对用户提示是否加载  <br/>
let g:ycm_confirm_extra_conf=0  <br/>
let g:ycm_autoclose_preview_window_after_completion=1  <br/>
let g:ycm_complete_in_comments = 1  &quot;在注释输入中也能补全<br/>
let g:ycm_complete_in_strings = 1   &quot;在字符串输入中也能补全<br/>
let g:ycm_collect_identifiers_from_comments_and_strings = 1   &quot;注释和字符串中的文字也会被收入补全<br/>
&quot; 跳到定义或声明  <br/>
nnoremap &lt;F2&gt; :YcmCompleter GoToDefinitionElseDeclaration&lt;CR&gt;  <br/>
&quot; 强制进行编译  <br/>
nnoremap &lt;F5&gt; :YcmForceCompileAndDiagnostics&lt;CR&gt;  <br/>
&quot;==========================================<br/>
&quot; Syntastic settings<br/>
&quot;==========================================<br/>
Bundle &#39;scrooloose/syntastic&#39;  <br/>
&quot; 在打开文件的时候检查  <br/>
let g:syntastic_check_on_open = 1  <br/>
let g:syntastic_cpp_include_dirs = [&#39;/usr/include/&#39;]  <br/>
let g:syntastic_cpp_remove_include_errors = 1  <br/>
let g:syntastic_cpp_check_header = 1  <br/>
let g:syntastic_cpp_compiler = &#39;clang++&#39;  <br/>
let g:syntastic_cpp_compiler_options = &#39;-std=c++11 -stdlib=libstdc++&#39;  <br/>
&quot;set error or warning signs  <br/>
let g:syntastic_error_symbol = &#39;✗&#39;  <br/>
let g:syntastic_warning_symbol = &#39;⚠&#39;  <br/>
&quot;whether to show balloons  <br/>
let g:syntastic_enable_balloons = 1  <br/>
let g:syntastic_always_populate_loc_list = 1  <br/>
&quot;==========================================<br/>
&quot; ListToggle settings<br/>
&quot;==========================================<br/>
let g:lt_location_list_toggle_map = &#39;&lt;leader&gt;l&#39;  <br/>
let g:lt_quickfix_list_toggle_map = &#39;&lt;leader&gt;q&#39;  <br/>
&quot;==========================================<br/>
&quot; NERDtree settings<br/>
&quot;==========================================<br/>
Bundle &#39;scrooloose/nerdtree&#39;  <br/>
let NERDTreeWinPos=&#39;left&#39;  <br/>
let NERDTreeHighlightCursorline=1<br/>
nnoremap &lt;leader&gt;n :NERDTreeToggle&lt;CR&gt;  <br/>
autocmd bufenter * if (winnr(&quot;$&quot;) == 1 &amp;&amp; exists(&quot;b:NERDTreeType&quot;) &amp;&amp;b:NERDTreeType == &quot;primary&quot;) | q | endif  <br/>
&quot;==========================================<br/>
&quot; miniBufExpl settings<br/>
&quot;==========================================<br/>
&quot;Bundle &#39;fholgado/minibufexpl.vim&#39;<br/>
&quot;let g:miniBufExplMapWindowNavVim = 1<br/>
&quot;let g:miniBufExplMapWindowNavArrows = 1<br/>
&quot;let g:miniBufExplMapCTabSwitchBufs = 1<br/>
&quot;let g:miniBufExplModSelTarget = 1<br/>
&quot;&quot;解决FileExplorer窗口变小问题<br/>
&quot;let g:miniBufExplForceSyntaxEnable = 1<br/>
&quot;let g:miniBufExplorerMoreThanOne=2<br/>
&quot;let g:miniBufExplCycleArround=1<br/>
&quot;&quot; 默认方向键左右可以切换buffer<br/>
&quot;nnoremap &lt;TAB&gt; :MBEbn&lt;CR&gt;<br/>
&quot;nnoremap &lt;s-TAB&gt; :MBEbp&lt;CR&gt;<br/>
&quot;noremap &lt;leader&gt;bn :MBEbn&lt;CR&gt;<br/>
&quot;noremap &lt;leader&gt;bp :MBEbp&lt;CR&gt;<br/>
&quot;noremap &lt;leader&gt;bd :MBEbd&lt;CR&gt;<br/>
&quot;==========================================<br/>
&quot; FuzzyFinder settings<br/>
&quot;==========================================<br/>
&quot;Bundle &#39;FuzzyFinder&#39;  <br/>
&quot;nnoremap &lt;leader&gt;f :FufFile&lt;CR&gt;  <br/>
&quot;nnoremap &lt;leader&gt;b :FufBuffer&lt;CR&gt;  <br/>
&quot;nnoremap &lt;leader&gt;d :FufDir&lt;CR&gt;  <br/>
&quot;==========================================<br/>
&quot; UltiSnips settings<br/>
&quot;==========================================<br/>
Bundle &#39;SirVer/ultisnips&#39;  <br/>
Bundle &#39;honza/vim-snippets&#39;<br/>
let g:UltiSnipsExpandTrigger = &quot;&lt;c-j&gt;&quot;<br/>
let g:UltiSnipsJumpForwardTrigger = &quot;&lt;c-j&gt;&quot;<br/>
let g:UltiSnipsJumpBackwardTrigger = &quot;&lt;c-k&gt;&quot;<br/>
&quot; 定义存放代码片段的文件夹 .vim/additional_snippets下，使用自定义和默认的，将会的到全局，有冲突的会提示<br/>
let g:UltiSnipsSnippetDirectories=[&quot;additional_snippets&quot;, &#39;UltiSnips&#39;]<br/>
&quot;==========================================<br/>
&quot; closetag settings 自动补全html/xml标签<br/>
&quot;==========================================<br/>
&quot;Bundle &#39;docunext/closetag.vim&#39;<br/>
&quot;let g:closetag_html_style=1<br/>
&quot;==========================================<br/>
&quot; Markdown settings<br/>
&quot;==========================================<br/>
&quot;Bundle &#39;plasticboy/vim-markdown&#39;<br/>
&quot;let g:vim_markdown_folding_disabled=1<br/>
&quot;==========================================<br/>
&quot; Tagbar settings<br/>
&quot;==========================================<br/>
Bundle &#39;majutsushi/tagbar&#39;  <br/>
nnoremap &lt;leader&gt;tb :Tagbar&lt;CR&gt;  <br/>
let g:tagbar_autofocus = 1<br/>
&quot;==========================================<br/>
&quot; A settings<br/>
&quot;==========================================<br/>
nnoremap &lt;F4&gt; :A&lt;CR&gt;  <br/>
&quot;==========================================<br/>
&quot; Powerline settings<br/>
&quot;==========================================<br/>
Bundle &#39;Lokaltog/vim-powerline&#39;  <br/>
let g:Powerline_symbolsa = &#39;fancy&#39;  <br/>
let g:Powerline_cache_enabled = 1  <br/>
&quot;&quot;let g:session_autoload=&#39;yes&#39;  <br/>
&quot;&quot;let g:session_autosave=&#39;yes&#39;  <br/>
&quot; 因为Vundle需要关闭filetype,而之后的插件如果想要正常使用，必须要打开filetype<br/>
&quot; 所以必须确保所有插件的加载过程在之前已经全部添加完毕<br/>
filetype on             <br/>
&quot; 参考链接:  <br/>
&quot; amix vimrc模板地址参考:amix.dk/vim/vimrc.html  <br/>
&quot; k-vim https://github.com/wklken/k-vim
</code></pre></li>
<li><p>打开vim,执行<code>:BundleInstall</code></p></li>
</ol>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2019/01/17</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='linux.html'>Linux</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15440788666202.html">
                
                  <h1>利用SoftetherVPN和Bind9穿透内网，共享局域网内部资源</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<h2 id="toc_0">写在前面</h2>

<p>我想很多公司由于安全考虑，一些内部系统(Git仓库、OA之类）的一定是放在公司内部的服务器上，只有在公司的网络下才能够访问，但是一些公司的随着业务的发展，肯定会出现一些外地的同事（外地的办事处、研发中心、销售团队等等）这种情况，这样一来，在内部服务不迁移到外网的前提下，如何让外地的同事能访问到内网这些资源就成了一个必须要解决的问题了。<br/>
其实内网穿透有很很多种解决方案，本文只是利用SoftetherVPN以及Bind9这两个工具提供另一种解决思路。<br/>
本文所提到的解决方案有如下优点:</p>

<pre><code class="language-text">1. 原来的内部资源不需要额外的配置改动
2. 需要身份认证，只有拥有权限的外部人员才能访问内部资源
3. 只有加入了共享网络的内部资源才能被外部访问，没有开放共享的内部资源的无法访问
4. 可以做到通过相同的域名访问同一个内部资源
5. 通过LPTP,LPSec协议支持OS X以及iOS设备访问
</code></pre>

<p>当然也有如下不足:<br/>
    1. 需要一台拥有公网IP的服务器作为中心服务器<br/>
    2. 由于本文的解决方案是基于虚拟局域网来实现的，因此拥有局域网内一些无法回避的缺点。</p>

<h2 id="toc_1">原理</h2>

<p><img src="https://pic.mylonly.com/2018-12-06-%E7%BD%91%E7%BB%9C%E5%9B%BE%20-1-.png" alt=""/><br/>
本解决方案利用了SoftetherVPN提供的Ad-Hoc VPN将内网服务器和外部用户通过VLAN连接在同一个局域网内，然后通过支持智能解析的DNS服务器，将域名解析到对应的虚拟局域网IP。<br/>
如果是内网用户，则直接通过DNS服务器将域名解析到内部资源对应的内网IP。</p>

<h2 id="toc_2">部署</h2>

<p>本次部署大部分采用Docker方式部署，如果需要手动安装的，可以在<a href="https://www.softether-download.com/cn.aspx?product=softether">这个网站</a>下载对应的安装包</p>

<h3 id="toc_3">Docker 环境</h3>

<p>略，不再本文讨论范围之内</p>

<h3 id="toc_4">安装Softether Server</h3>

<ol>
<li><p>拉取镜像</p>
<pre><code class="language-text">siomiz/softethervpn
</code></pre></li>
<li><p>启动vpnserver</p>
<pre><code class="language-text">docker run -d --cap-add NET_ADMIN \
 -p 500:500/udp \<br/>
 -p 4500:4500/udp \<br/>
 -p 1701:1701/tcp \<br/>
 -p 1194:1194/udp \<br/>
 -p 5555:5555/tcp \<br/>
 -p 443:443/tcp \<br/>
 -p 992:992 \<br/>
 siomiz/softethervpn
</code></pre>
<p>记得要开放对应的端口</p></li>
</ol>

<h3 id="toc_5">安装Softether ServerManger</h3>

<p>虽然Softether 提供了mac版的安装包，但本人装完之后发现其实是套了一个wine的环境，在mac上体验极差，所以此处推荐找一个windows电脑安装vpn server manager，<a href="https://www.softether-download.com/cn.aspx?product=softether">下载地址</a>在此<br/>
由于是windows上的安装教程，大部分都是图片，为了不占文章篇幅，就不放在文章里介绍了，各位可以参考<a href="https://www.softether.org/4-docs/2-howto/1.VPN_for_On-premise/1.Ad-hoc_VPN">官网</a>或者这篇<a href="http://www.leqii.com/download/yulan/d77/d77.html">博客</a></p>

<p>其中需要注意的是，在<code>虚拟HUB管理页面</code>中的<code>虚拟NAT和虚拟DHCP服务器</code>，点击<code>SecureNAT</code>,然后设置DHCP服务器的网段，以及DNS服务器为下面将要搭建的DNS服务器地址<br/>
<img src="https://pic.mylonly.com/2018-12-06-101214.png" alt=""/></p>

<h3 id="toc_6">部署DNS服务器</h3>

<ol>
<li><p>安装bind9</p>
<pre><code class="language-text">sudo apt-get install bind9
</code></pre></li>
<li><p>增加两个视图文件,在/etc/bind/目录下<br/>
name.2.conf</p>
<pre><code class="language-text">acl &quot;2&quot; {
    192.168.2.0/24;<br/>
};   
</code></pre>
<p>name.111.conf </p>
<pre><code class="language-text">acl &quot;111&quot; {
    192.168.111.0/24;<br/>
};
</code></pre>
<p>两个视图文件主要是为了区分来源IP所在的网段，然后根据不同的网段返回不同的解析结果，在本解决方案当中，192.168.2.0/24网段为内网网段，   192.168.111.0/24为VPN生成的虚拟局域网的网段</p></li>
<li><p>新建不同网段对应的不同的解析记录文件，也在/etc/bind/目录下</p>
<p>1234tv.lan-2.zone</p>
<pre><code class="language-text">$TTL    604800
@       IN      SOA      xxxx.xx. root.xxxx.xx. (<br/>
                              2         ; Serial<br/>
                         604800         ; Refresh<br/>
                          86400         ; Retry<br/>
                        2419200         ; Expire<br/>
                         604800 )       ; Negative Cache TTL<br/>
;<br/>
@       IN      NS      xxxx.xx.<br/>
@       IN      A      192.168.2.222<br/>
gitlab  IN      A       192.168.2.84
</code></pre>
<p>1234tv.lan-111.zone</p>
<pre><code class="language-text">$TTL    604800
@       IN      SOA     xxxx.xx. root.xxxx.xx. (<br/>
                              2         ; Serial<br/>
                         604800         ; Refresh<br/>
                          86400         ; Retry<br/>
                        2419200         ; Expire<br/>
                         604800 )       ; Negative Cache TTL<br/>
;<br/>
@       IN      NS      xxxx.xx.<br/>
@       IN      A       192.168.111.222<br/>
gitlab  IN      A       192.168.111.84
</code></pre></li>
<li><p>将视图文件和解析文件写入Bind9主配置文件</p>
<pre><code class="language-text">sudo vim /etc/bind/name.conf
</code></pre>
<p>增加如下内容，声明两个视图，view_2,view_11,可以注释掉默认带的配置文件，如果你没有其他的用途的话,注意每一行后面的分号，不可缺少。</p>
<pre><code class="language-text">#include &quot;/etc/bind/named.conf.options&quot;;
#include &quot;/etc/bind/named.conf.local&quot;;<br/>
#include &quot;/etc/bind/named.conf.default-zones&quot;;<br/>
include &quot;/etc/bind/name.2.conf&quot;;<br/>
view &quot;View_2&quot; {<br/>
        match-clients {&quot;2&quot;;};<br/>
        zone &quot;xxxx.xxx&quot; IN {<br/>
                type master;<br/>
                file &quot;xxxx.xxx-2.zone&quot;;<br/>
                allow-update {none;};<br/>
        };<br/>
};<br/>
include &quot;/etc/bind/name.111.conf&quot;;<br/>
view &quot;View_111&quot; {<br/>
        match-clients {&quot;111&quot;;};<br/>
        zone &quot;xxxx.xxx&quot; IN {<br/>
                type master;<br/>
                file &quot;xxxx.xxx-111.zone&quot;;<br/>
                allow-update {none;};<br/>
        };<br/>
};
</code></pre></li>
<li><p>然后启动Bind9 服务</p>
<pre><code class="language-text">sudo /etc/init.d/bind9 start
</code></pre></li>
<li><p>验证解析</p>
<pre><code class="language-text">dig gitlab.xxx.xx @192.168.2.222
</code></pre>
<p><img src="media/15440788666202/15440920519061.jpg" alt="" style="width:460px;"/></p></li>
</ol>

<h4 id="toc_7">安装Vpn Client</h4>

<p>所有需要共享给外部访问的内部服务器都需要安装vpn client连接上vpn server，下面的方法为linux 下docker方式部署vpn_client方法，windows端请参考这篇<a href="http://www.leqii.com/download/yulan/d77/d77.html">文章</a></p>

<ol>
<li><p>拉取镜像</p>
<pre><code class="language-text">sudo docker pull mitsutaka/softether-vpnclient
</code></pre></li>
<li><p>启动镜像连接之前创建的vpn server</p>
<pre><code class="language-text">docker run -d --name=softether-vpnclient \
--net=host --privileged \<br/>
-e VPN_SERVER=&lt;Softether VPN server&gt; \<br/>
-e VPN_PORT=&lt;Softether VPN port&gt; \<br/>
-e ACCOUNT_USER=&lt;Registered username&gt; \<br/>
-e ACCOUNT_PASS=&lt;Registered password&gt; \<br/>
-e VIRTUAL_HUB=&lt;Virtual Hub name&gt; \<br/>
-e TAP_IPADDR=&lt;IP address/netmask&gt; \<br/>
mitsutaka/softether-vpnclient<br/>
```<br/>
服务器端，VIRTUAL_HUB端填入之前在manager上新建的虚拟HUB名称 ，TAP_IPADDR，最好采用指定IP的方式，尤其是DNS服务器，需要固定IP地址
</code></pre></li>
</ol>

<h2 id="toc_8">结束语</h2>

<p>至此，这个简单的内网穿透方案算是部署完成，内网用户可以直接通过设置内网DNS服务器来通过域名访问内部服务器，外网用户在使用vpn clinet连接上虚拟局域网之后也能通过相同的域名访问内部服务器资源。<br/>
写这篇文章，一方面是觉得自己以后可能还会有此需求，怕自己遗忘，权且当做记录。另外也是想也可能有别的同学有这方面的需要，写出来共享一下。</p>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2018/12/06</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='linux.html'>Linux</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15319308951102.html">
                
                  <h1>PT924光猫 更改桥接模式/路由模式</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<ol>
<li><p><a href="http://192.168.1.1:8080/cgi-bin/index2.asp">http://192.168.1.1:8080/cgi-bin/index2.asp</a> 进入这个页面<br/>
用useradmin账号密码登录</p></li>
<li><p>将地址改为<a href="http://192.168.1.1:8080/cgi-bin/net-wanset.asp">http://192.168.1.1:8080/cgi-bin/net-wanset.asp</a> 进入internet设置页面(更改其他地址也会进入其他页面)</p>
<p><img src="media/15319308951102/15319310908143.jpg" alt="" style="width:532px;"/></p></li>
</ol>

<p>其中<code>6_INTERNET_B_VID_229</code>是桥接模式，路由器需要拨号，而<code>5_INTERNET_R_VID_229</code>是路由模式，由猫拨号，路由器不需要拨号</p>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2018/07/19</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='linux.html'>Linux</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
              


			<div class="row">
			  <div class="large-6 columns">
			  <p class="text-left" style="padding-top:25px;">
			   
			  </p>
			  </div>
			  <div class="large-6 columns">
			<p class="text-right" style="padding-top:25px;">
			 <a href="linux_1.html">&raquo; Next Page</a> 
			</p>
			  </div>
			</div>
		</div>
	</div><!-- large 8 -->

 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <div class="site-a-logo"><img src="https://pic.mylonly.com/2017-05-11-IMG_1164.JPG" /></div>
            
                <h1>独自一人</h1>
                <div class="site-des">独自一人,独自Coding...</div>
                <div class="social">









<a target="_blank" class="github" target="_blank" href="https://github.com/mylonly" title="GitHub">GitHub</a>
<a target="_blank" class="email" href="mailto:root@mylonly.com" title="Email">Email</a>
  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="ios.html"><strong>iOS</strong></a>
        
            <a href="linux.html"><strong>Linux</strong></a>
        
            <a href="python.html"><strong>Python</strong></a>
        
            <a href="tools.html"><strong>Tools</strong></a>
        
            <a href="django-learn.html"><strong>Django学习</strong></a>
        
            <a href="Weex.html"><strong>Weex</strong></a>
        
            <a href="Tensorflow.html"><strong>Tensorflow</strong></a>
        
            <a href="%E8%BF%9C%E5%8F%A4%E7%9F%A5%E8%AF%86.html"><strong>远古知识</strong></a>
        
            <a href="Kali%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95.html"><strong>Kali渗透测试</strong></a>
        
            <a href="docker.html"><strong>Docker</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="15595559159421.html">Linux 测试磁盘性能</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15516896130866.html">Docker</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15480624203516.html">Ubuntu安装开发者工具包(make,g++,cc之类工具)</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15477022109795.html">别人的vim配置文件</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15440788666202.html">利用SoftetherVPN和Bind9穿透内网，共享局域网内部资源</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    



  </body>
</html>
